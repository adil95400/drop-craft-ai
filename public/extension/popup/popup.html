<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ShopOpti+ Pro</title>
  <link rel="stylesheet" href="popup.css">
</head>
<body>
  <div id="app">
    <!-- Loading State -->
    <div id="loading" class="screen">
      <div class="loading-spinner"></div>
      <p>Chargement...</p>
    </div>

    <!-- Login Screen -->
    <div id="login-screen" class="screen" style="display: none;">
      <div class="header">
        <div class="logo">
          <svg viewBox="0 0 40 40" class="logo-icon">
            <circle cx="20" cy="20" r="18" fill="url(#gradient)"/>
            <path d="M12 20l5 5 11-11" stroke="white" stroke-width="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
            <defs>
              <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" stop-color="#8B5CF6"/>
                <stop offset="100%" stop-color="#6366F1"/>
              </linearGradient>
            </defs>
          </svg>
          <span class="logo-text">ShopOpti+ Pro</span>
        </div>
        <span class="version">v7.0.0</span>
      </div>

      <div class="login-form">
        <h2>Connexion</h2>
        <p class="subtitle">Connectez-vous pour importer des produits</p>
        
        <form id="login-form">
          <div class="input-group">
            <label for="email">Email</label>
            <input type="email" id="email" placeholder="votre@email.com" required>
          </div>
          <div class="input-group">
            <label for="password">Mot de passe</label>
            <input type="password" id="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
          </div>
          <div id="login-error" class="error-message" style="display: none;"></div>
          <button type="submit" class="btn btn-primary">
            <span id="login-text">Se connecter</span>
            <span id="login-loading" style="display: none;">Connexion...</span>
          </button>
        </form>

        <p class="signup-link">
          Pas encore de compte ? 
          <a href="https://drop-craft-ai.lovable.app/auth" target="_blank">Cr√©er un compte</a>
        </p>
      </div>
    </div>

    <!-- Main Screen -->
    <div id="main-screen" class="screen" style="display: none;">
      <div class="header">
        <div class="logo">
          <svg viewBox="0 0 40 40" class="logo-icon">
            <circle cx="20" cy="20" r="18" fill="url(#gradient2)"/>
            <path d="M12 20l5 5 11-11" stroke="white" stroke-width="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
            <defs>
              <linearGradient id="gradient2" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" stop-color="#8B5CF6"/>
                <stop offset="100%" stop-color="#6366F1"/>
              </linearGradient>
            </defs>
          </svg>
          <span class="logo-text">ShopOpti+</span>
        </div>
        <button id="settings-btn" class="icon-btn" title="Param√®tres">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12.22 2h-.44a2 2 0 00-2 2v.18a2 2 0 01-1 1.73l-.43.25a2 2 0 01-2 0l-.15-.08a2 2 0 00-2.73.73l-.22.38a2 2 0 00.73 2.73l.15.1a2 2 0 011 1.72v.51a2 2 0 01-1 1.74l-.15.09a2 2 0 00-.73 2.73l.22.38a2 2 0 002.73.73l.15-.08a2 2 0 012 0l.43.25a2 2 0 011 1.73V20a2 2 0 002 2h.44a2 2 0 002-2v-.18a2 2 0 011-1.73l.43-.25a2 2 0 012 0l.15.08a2 2 0 002.73-.73l.22-.39a2 2 0 00-.73-2.73l-.15-.08a2 2 0 01-1-1.74v-.5a2 2 0 011-1.74l.15-.09a2 2 0 00.73-2.73l-.22-.38a2 2 0 00-2.73-.73l-.15.08a2 2 0 01-2 0l-.43-.25a2 2 0 01-1-1.73V4a2 2 0 00-2-2z"/>
            <circle cx="12" cy="12" r="3"/>
          </svg>
        </button>
      </div>

      <!-- User Info -->
      <div class="user-card">
        <div class="user-info">
          <div class="user-avatar" id="user-avatar">U</div>
          <div class="user-details">
            <span class="user-name" id="user-name">Utilisateur</span>
            <span class="user-email" id="user-email">email@exemple.com</span>
          </div>
        </div>
        <span class="user-plan" id="user-plan">Free</span>
      </div>

      <!-- Stats -->
      <div class="stats-grid">
        <div class="stat-card">
          <span class="stat-value" id="stat-imported">0</span>
          <span class="stat-label">Import√©s</span>
        </div>
        <div class="stat-card">
          <span class="stat-value" id="stat-today">0</span>
          <span class="stat-label">Aujourd'hui</span>
        </div>
        <div class="stat-card">
          <span class="stat-value" id="stat-synced">0</span>
          <span class="stat-label">Synchronis√©s</span>
        </div>
      </div>

      <!-- Current Product (simple view) -->
      <div class="current-product" id="current-product" style="display: none;">
        <div class="section-title">Produit d√©tect√©</div>
        <div class="product-card">
          <img class="product-image" id="product-image" src="" alt="Product">
          <div class="product-info">
            <div class="product-title" id="product-title"></div>
            <div class="product-meta">
              <span class="product-price" id="product-price"></span>
              <span class="product-platform" id="product-platform"></span>
            </div>
          </div>
        </div>
        <!-- P3: Dedup badge -->
        <div id="dedup-badge" class="dedup-badge" style="display:none;"></div>
        
        <!-- P3: Action buttons -->
        <div class="product-actions">
          <button class="btn btn-secondary btn-sm" id="preview-btn">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
              <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
              <circle cx="12" cy="12" r="3"/>
            </svg>
            Preview Pro
          </button>
          <button class="btn btn-primary btn-sm" id="import-btn">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
              <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3"/>
            </svg>
            Importer
          </button>
        </div>
      </div>

      <!-- No Product -->
      <div class="no-product" id="no-product">
        <div class="no-product-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M21 16V8a2 2 0 00-1-1.73l-7-4a2 2 0 00-2 0l-7 4A2 2 0 003 8v8a2 2 0 001 1.73l7 4a2 2 0 002 0l7-4A2 2 0 0021 16z"/>
            <polyline points="3.27 6.96 12 12.01 20.73 6.96"/>
            <line x1="12" y1="22.08" x2="12" y2="12"/>
          </svg>
        </div>
        <p>Naviguez sur une page produit</p>
        <p class="hint">AliExpress, Amazon, eBay, et plus...</p>
      </div>

      <!-- Quick Actions -->
      <div class="quick-actions">
        <button class="quick-action" id="open-dashboard">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
          Dashboard
        </button>
        <button class="quick-action" id="view-products">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 01-8 0"/></svg>
          Produits
        </button>
        <button class="quick-action" id="debug-btn">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"/><path d="M12 8v4M12 16h.01"/></svg>
          Debug
        </button>
        <button class="quick-action" id="import-logs-btn">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
          Imports
        </button>
        <button class="quick-action" id="logout-btn">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
          D√©connexion
        </button>
      </div>

      <!-- Import Logs Panel -->
      <div id="import-logs-panel" style="display: none; margin-top: 8px;">
        <div class="section-title" style="display:flex;justify-content:space-between;align-items:center;">
          <span>üìã Historique d'imports</span>
          <button id="import-logs-clear" class="icon-btn" style="font-size:10px;padding:2px 8px;">Vider</button>
        </div>
        <div id="import-logs-list" style="font-size:11px;background:#1a1a2e;color:#e0e0e0;padding:8px;border-radius:6px;max-height:220px;overflow-y:auto;font-family:monospace;"></div>
      </div>

      <!-- Debug Panel -->
      <div id="debug-panel" style="display: none;">
        <div class="section-title" style="display:flex;justify-content:space-between;align-items:center;">
          <span>üîç Diagnostics</span>
          <button id="debug-refresh" class="icon-btn" style="font-size:12px;padding:2px 8px;">‚Üª</button>
        </div>
        <div id="debug-content" style="font-size:11px;background:#1a1a2e;color:#e0e0e0;padding:8px;border-radius:6px;max-height:200px;overflow-y:auto;font-family:monospace;white-space:pre-wrap;word-break:break-all;"></div>
        <div style="margin-top:6px;display:flex;gap:4px;">
          <button id="debug-logs" class="btn btn-secondary" style="font-size:10px;padding:4px 8px;flex:1;">Logs</button>
          <button id="debug-errors" class="btn btn-secondary" style="font-size:10px;padding:4px 8px;flex:1;">Erreurs</button>
          <button id="debug-api" class="btn btn-secondary" style="font-size:10px;padding:4px 8px;flex:1;">API</button>
        </div>
      </div>
    </div>

    <!-- P3: Preview Pro Screen -->
    <div id="preview-screen" class="screen" style="display: none;">
      <div class="header">
        <button id="preview-back-btn" class="icon-btn">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
        </button>
        <span class="header-title">üìã Import Preview Pro</span>
        <div></div>
      </div>

      <div class="preview-content">
        <!-- Dedup Status -->
        <div id="preview-dedup-status" class="preview-dedup-status" style="display:none;"></div>

        <!-- Images Gallery -->
        <div class="preview-section">
          <div class="section-title">Images</div>
          <div id="preview-images" class="preview-images-grid"></div>
        </div>

        <!-- Title (editable) -->
        <div class="preview-section">
          <div class="section-title">Titre</div>
          <textarea id="preview-title" class="preview-editable" rows="2"></textarea>
        </div>

        <!-- Price & Margin -->
        <div class="preview-section">
          <div class="section-title">Prix</div>
          <div class="preview-price-row">
            <div class="preview-price-item">
              <span class="preview-price-label">Co√ªt</span>
              <span id="preview-cost" class="preview-price-value">0.00 ‚Ç¨</span>
            </div>
            <div class="preview-price-item">
              <span class="preview-price-label">Marge</span>
              <span id="preview-margin" class="preview-price-value">30%</span>
            </div>
            <div class="preview-price-item">
              <span class="preview-price-label">Prix vente</span>
              <input id="preview-sell-price" type="number" step="0.01" class="preview-price-input">
            </div>
          </div>
        </div>

        <!-- Description (editable) -->
        <div class="preview-section">
          <div class="section-title">Description</div>
          <textarea id="preview-description" class="preview-editable" rows="4"></textarea>
        </div>

        <!-- Variants -->
        <div class="preview-section" id="preview-variants-section" style="display:none;">
          <div class="section-title">Variantes <span id="preview-variant-count" class="badge">0</span></div>
          <div id="preview-variants" class="preview-variants-list"></div>
        </div>

        <!-- Meta info -->
        <div class="preview-section">
          <div class="preview-meta-row">
            <span class="preview-meta-tag" id="preview-platform-tag"></span>
            <span class="preview-meta-tag" id="preview-brand-tag"></span>
            <span class="preview-meta-tag" id="preview-category-tag"></span>
          </div>
        </div>

        <!-- Actions -->
        <div class="preview-actions">
          <button class="btn btn-secondary" id="preview-cancel-btn">Annuler</button>
          <button class="btn btn-primary" id="preview-confirm-btn">‚úì Confirmer l'import</button>
        </div>

        <!-- Merge Option (shown for duplicates) -->
        <div id="preview-merge-section" class="preview-merge-section" style="display:none;">
          <div class="section-title">ü§ñ Merge IA disponible</div>
          <p class="preview-merge-text">Un produit similaire existe d√©j√†. Voulez-vous fusionner intelligemment ?</p>
          <button class="btn btn-warning" id="preview-merge-btn">üîÄ Fusionner avec IA</button>
        </div>
      </div>
    </div>

    <!-- Settings Screen -->
    <div id="settings-screen" class="screen" style="display: none;">
      <div class="header">
        <button id="back-btn" class="icon-btn">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
        </button>
        <span class="header-title">Param√®tres</span>
        <div></div>
      </div>

      <div class="settings-content">
        <div class="setting-group">
          <div class="setting-item">
            <div class="setting-info">
              <span class="setting-label">Import automatique</span>
              <span class="setting-desc">Importer automatiquement les produits d√©tect√©s</span>
            </div>
            <label class="switch">
              <input type="checkbox" id="setting-auto-import">
              <span class="slider"></span>
            </label>
          </div>
          <div class="setting-item">
            <div class="setting-info">
              <span class="setting-label">Marge de prix (%)</span>
              <span class="setting-desc">Marge appliqu√©e au prix d'achat</span>
            </div>
            <input type="number" id="setting-margin" class="setting-input" value="30" min="0" max="500">
          </div>
          <div class="setting-item">
            <div class="setting-info">
              <span class="setting-label">Arrondi de prix</span>
              <span class="setting-desc">Comment arrondir les prix calcul√©s</span>
            </div>
            <select id="setting-rounding" class="setting-select">
              <option value="ceil_99">X,99 ‚Ç¨</option>
              <option value="ceil">Arrondi sup√©rieur</option>
              <option value="round">Arrondi normal</option>
              <option value="floor">Arrondi inf√©rieur</option>
            </select>
          </div>
          <div class="setting-item">
            <div class="setting-info">
              <span class="setting-label">Notifications</span>
              <span class="setting-desc">Recevoir des notifications pour les imports</span>
            </div>
            <label class="switch">
              <input type="checkbox" id="setting-notifications" checked>
              <span class="slider"></span>
            </label>
          </div>
        </div>

        <button class="btn btn-primary" id="save-settings">Sauvegarder les param√®tres</button>
        <button class="btn btn-secondary" id="sync-settings">Synchroniser avec ShopOpti</button>
      </div>
    </div>
  </div>

  <script src="popup.js"></script>
</body>
</html>
